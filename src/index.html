<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>☍ Akobir ☍</title>
</head>
<body style="font-family:sans-serif;background:#0f172a;color:white;margin:0;padding:20px;">

<h1 style="text-align:center;color:#c084fc;">☍ Welcome to my site saver! ☍</h1>
<p style="text-align:center;color:#d8b4fe;">Save and Open it if you need it!</p>

<!-- Add site -->
<div style="max-width:600px;margin:20px auto;padding:15px;border:1px solid #444;border-radius:10px;">
  <input id="name" placeholder="Site name" style="width:97%;padding:8px;border-radius:5px;border:none;margin-right:2%;background:#1e1b4b;color:white;">
  <input id="url" placeholder="https://..." style="width:97%;margin-top:10px;padding:8px;border-radius:5px;border:none;background:#1e1b4b;color:white;">
  <button id="add" style="width:100%;margin-top:10px;padding:10px;background:#7c3aed;color:white;border:none;border-radius:5px;cursor:pointer;">Add</button>
</div>

<!-- Search, stats, list -->
<div style="max-width:600px;margin:0 auto;">
  <input id="search" placeholder="Search..." style="width:100%;padding:8px;border:none;border-radius:5px;background:#1e1b4b;color:white;margin-bottom:10px;">
  <div id="stats" style="text-align:right;margin-bottom:10px;color:#a78bfa;"></div>
  <div id="list"></div>
</div>

<!-- Export / Import -->
<div style="max-width:600px;margin:20px auto;text-align:center;">
  <button id="exportBtn" style="padding:10px 15px;background:#22c55e;color:white;border:none;border-radius:5px;cursor:pointer;margin-right:5px;">Export JSON</button>
  <input type="file" id="importFile" style="display:none;">
  <button id="importBtn" style="padding:10px 15px;background:#3b82f6;color:white;border:none;border-radius:5px;cursor:pointer;">Import JSON</button>
</div>

<script>
const dbKey = 'sitesDB_minimal';

function getSites(){ return JSON.parse(localStorage.getItem(dbKey) || '[]'); }
function saveSites(data){ localStorage.setItem(dbKey, JSON.stringify(data)); render(); }

// Render function
function render(query=''){
  const sites = getSites().filter(s=> 
    s.name.toLowerCase().includes(query.toLowerCase()) || 
    s.url.toLowerCase().includes(query.toLowerCase())
  );
  const list = document.getElementById('list');
  const stats = document.getElementById('stats');
  stats.textContent = `Total: ${sites.length}`;
  if(!sites.length){ 
    list.innerHTML = '<p style="text-align:center;color:#9ca3af;">Nothing found</p>'; 
    return; 
  }
  list.innerHTML = sites.map(s=>`
    <div style="background:#1e1b4b;margin:8px 0;padding:10px;border-radius:8px;overflow:hidden;">
      <b>${s.name}</b><br>
      <a href="${s.url}" target="_blank" style="color:#a78bfa;text-decoration:none;">${s.url}</a>
      <button data-id="${s.id}" class="del-btn" style="float:right;background:#ef4444;border:none;color:white;padding:3px 7px;border-radius:4px;cursor:pointer;">delete</button>
    </div>
  `).join('');
}

// Add site
function addSite(){
  const name=document.getElementById('name').value.trim();
  let url=document.getElementById('url').value.trim();
  if(!name||!url){alert('Please enter name and URL!');return;}
  if(!url.startsWith('http')) url='https://'+url;
  const sites=getSites();
  sites.unshift({id:Date.now(),name,url});
  saveSites(sites);
  document.getElementById('name').value='';
  document.getElementById('url').value='';
}

// Delete site (delegation)
document.getElementById('list').addEventListener('click', (e)=>{
  if(e.target.classList.contains('del-btn')){
    const id = Number(e.target.getAttribute('data-id'));
    if(confirm('Are you sure you want to delete?')){
      const sites = getSites().filter(s=>s.id !== id);
      saveSites(sites);
    }
  }
});

// Export JSON
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const sites = getSites();
  const blob = new Blob([JSON.stringify(sites,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'sites_backup.json';
  a.click();
  URL.revokeObjectURL(url);
});

// Import JSON
document.getElementById('importBtn').addEventListener('click', ()=>{
  document.getElementById('importFile').click();
});
document.getElementById('importFile').addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = (ev)=>{
    try{
      const imported = JSON.parse(ev.target.result);
      if(Array.isArray(imported)){
        localStorage.setItem(dbKey, JSON.stringify(imported));
        render();
        alert('Data successfully imported!');
      }else{
        alert('File format is incorrect!');
      }
    }catch(err){
      alert('Error reading JSON file!');
    }
  };
  reader.readAsText(file);
});

document.getElementById('add').onclick=addSite;
document.getElementById('search').oninput=(e)=>render(e.target.value);
document.addEventListener('DOMContentLoaded',()=>render());
</script>

</body>
</html>